# BOLD Dataset Analysis 

This repo provides a pipeline/method for analyzing toxicity and sentiment in text completions generated from the **BOLD (Bias in Open-ended Language Generation)** dataset. It uses GPT-2 for text generation, Detoxify for toxicity measurement, and VADER for sentiment analysis.

## Features

- **Data Download**: Automated scripts to fetch BOLD dataset files (gender and race prompts).
- **Sampling**: Configurable sampling of prompts to control analysis scale.
- **Analysis Engine**: Full pipeline integrating text generation, toxicity scoring, and sentiment intensity analysis.
- **Reporting**: Structured output in CSV format for easy evaluation and visualization.

## Prerequisites

- Python 3.7+

## Setup Instructions

1. **Clone the project** or download the source files.
2. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

## Environment Variables & API Keys

While this project currently uses local models, you may want to use environment variables for higher rate limits or private models.

1. **Copy the example environment file**:
   ```bash
   cp .env.example .env
   ```
2. **Edit `.env`** and add your keys:
   - `OPENAI_API_KEY`: If you extend the script to use OpenAI models.

## Usage

### 1. Download the Dataset
If you don't have the BOLD JSON files (`gender_prompt.json`, `race_prompt.json`), run:
```bash
python download_data.py
```

### 2. Sample Prompts
To create a subset of prompts for analysis (defaults to 20 per category):
```bash
python sample_prompts.py
```
This generates `sampled_prompts.json`.

### 3. Run Analysis
To generate completions and perform toxicity/sentiment analysis:
```bash
python analyze_bold.py
```
**Note**: On first run, this will download several hundred MBs of models (GPT-2 and Detoxify).

## Output

The results are saved to `results.csv` with the following columns:
- `category`: BOLD category (e.g., gender, race).
- `subject`: The specific subject of the prompt.
- `prompt`: The input text.
- `completion`: The text generated by the model.
- `toxicity`, `severe_toxicity`, etc.: Detoxify scores.
- `sentiment_compound`, `sentiment_pos`, etc.: VADER sentiment scores.

## Project Structure

- `analyze_bold.py`: Core analysis script.
- `sample_prompts.py`: Utility for sampling prompts.
- `download_data.py`: Script to fetch BOLD data.
- `requirements.txt`: Python package dependencies.
- `results.csv`: Final analysis output.

## Technical Details

- **Text Generation**: `gpt2` via Hugging Face Transformers.
- **Toxicity Analysis**: [Detoxify](https://github.com/unitaryai/detoxify) (original model).
- **Sentiment Analysis**: [VADER](https://github.com/cjhutto/vaderSentiment).
